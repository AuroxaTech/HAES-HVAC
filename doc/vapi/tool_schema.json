{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Vapi hael_route Tool Definition",
  "description": "Tool schema for HAES HVAC voice routing via Vapi",
  "tool_definition": {
    "type": "function",
    "messages": [
      {
        "type": "request-start",
        "content": "Let me check that for you."
      },
      {
        "type": "request-complete",
        "content": ""
      },
      {
        "type": "request-failed",
        "content": "I'm having trouble processing that request. Let me try again."
      },
      {
        "type": "request-response-delayed",
        "content": "This is taking a moment. Please hold.",
        "timingMilliseconds": 3000
      }
    ],
    "function": {
      "name": "hael_route",
      "description": "Submit a customer service request to the HAES system. Call this after collecting name, phone, address, and issue details from the customer.",
      "parameters": {
        "type": "object",
        "properties": {
          "request_type": {
            "type": "string",
            "enum": ["service_request", "quote_request", "schedule_appointment", "reschedule_appointment", "cancel_appointment", "status_check", "billing_inquiry", "general_inquiry"],
            "description": "Type of request: service_request (repair/fix), quote_request (pricing for new system), schedule_appointment, reschedule_appointment, cancel_appointment, status_check, billing_inquiry, or general_inquiry"
          },
          "customer_name": {
            "type": "string",
            "description": "Customer's full name"
          },
          "phone": {
            "type": "string",
            "description": "Customer's phone number for callback"
          },
          "email": {
            "type": "string",
            "description": "Customer's email address (optional)"
          },
          "address": {
            "type": "string",
            "description": "Full service address including street, city, state, and ZIP code"
          },
          "issue_description": {
            "type": "string",
            "description": "Description of the problem or request (e.g., 'heater not working', 'AC not cooling')"
          },
          "urgency": {
            "type": "string",
            "enum": ["emergency", "today", "this_week", "flexible"],
            "description": "How urgent: emergency (safety issue), today, this_week, or flexible"
          },
          "property_type": {
            "type": "string",
            "enum": ["residential", "commercial"],
            "description": "Type of property: residential or commercial"
          },
          "system_type": {
            "type": "string",
            "enum": ["furnace", "heat_pump", "boiler", "ac", "mini_split", "package_unit", "unknown"],
            "description": "Type of HVAC system: furnace, heat_pump, boiler, ac, mini_split, package_unit, or unknown"
          },
          "indoor_temperature_f": {
            "type": "integer",
            "description": "Current indoor temperature in Fahrenheit (ask when no heat or no AC is reported)"
          }
        },
        "required": ["request_type", "customer_name", "phone", "address", "issue_description"]
      }
    },
    "async": false,
    "server": {
      "url": "https://haes-hvac.fly.dev/vapi/server"
    }
  },
  "expected_response_schema": {
    "type": "object",
    "properties": {
      "results": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "toolCallId": {
              "type": "string",
              "description": "The ID from the original tool call"
            },
            "result": {
              "type": "string",
              "description": "JSON-stringified result object containing speak, action, and data"
            }
          },
          "required": ["toolCallId", "result"]
        }
      }
    },
    "required": ["results"]
  },
  "result_object_schema": {
    "type": "object",
    "properties": {
      "speak": {
        "type": "string",
        "description": "Message for the assistant to speak to the customer"
      },
      "action": {
        "type": "string",
        "enum": ["completed", "needs_human", "error"],
        "description": "Outcome of the request"
      },
      "data": {
        "type": "object",
        "description": "Additional data about the result (ticket ID, missing fields, etc.)"
      }
    },
    "required": ["speak", "action"]
  },
  "notes": {
    "vapi_dashboard_instructions": [
      "1. Go to Vapi Dashboard > Tools",
      "2. Create new function tool with the definition above",
      "3. Attach the tool to assistant 'Riley' (ID: f639ba5f-7c38-4949-9479-ec2a40428d76)",
      "4. Set serverUrlSecret to match VAPI_WEBHOOK_SECRET in Fly.io"
    ],
    "server_url": "https://haes-hvac.fly.dev/vapi/server",
    "signature_header": "X-Vapi-Signature"
  }
}
