{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Schedule Appointment Tool",
  "description": "Schedule a new appointment",
  "tool_definition": {
    "type": "function",
    "function": {
      "name": "schedule_appointment",
      "description": "Schedule a new service appointment. IMPORTANT: Do NOT ask the customer for preferred time windows or service type before the first call. First call: pass only customer_name, phone, address (no chosen_slot_start). Backend returns two time options â€” say them to the customer (e.g. I have Monday at 10 AM or Tuesday at 2 PM. Which works better for you?). After they choose, call again with same details PLUS chosen_slot_start (from response next_available_slots) OR preferred_date + preferred_time. Use when customer wants to book or asks about availability.",
      "parameters": {
        "type": "object",
        "properties": {
          "customer_name": {
            "type": "string",
            "description": "Customer's full name (required)"
          },
          "phone": {
            "type": "string",
            "description": "Customer's phone number (required)"
          },
          "email": {
            "type": "string",
            "description": "Customer's email address"
          },
          "address": {
            "type": "string",
            "description": "Full service address (required)"
          },
          "service_type": {
            "type": "string",
            "description": "Optional. Do not ask before first call; only include if already known (e.g. maintenance)."
          },
          "preferred_time_windows": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Optional. Do not ask before first call; backend returns two options without it."
          },
          "problem_description": {
            "type": "string",
            "description": "Problem description"
          },
          "property_type": {
            "type": "string",
            "enum": ["residential", "commercial", "property_management"],
            "description": "Type of property"
          },
          "chosen_slot_start": {
            "type": "string",
            "description": "On second call when booking: ISO datetime of the slot the customer chose (e.g. 2026-01-27T10:00:00). Copy from previous response next_available_slots[].start. Do not send on first call."
          },
          "confirmed_partner_id": {
            "type": "integer",
            "description": "Use this existing Odoo partner ID when customer confirmed their profile from lookup_customer_profile"
          },
          "caller_type": {
            "type": "string",
            "enum": ["tenant", "property_management"],
            "description": "Whether the caller is a tenant or part of the property management team"
          },
          "preferred_date": {
            "type": "string",
            "description": "Date of chosen slot (YYYY-MM-DD). Use with preferred_time when booking the chosen slot if chosen_slot_start is not available."
          },
          "preferred_time": {
            "type": "string",
            "description": "Time of chosen slot (e.g. 10:00). Use with preferred_date when booking the chosen slot if chosen_slot_start is not available."
          }
        },
        "required": ["customer_name", "phone", "address"]
      }
    },
    "async": false,
    "server": {
      "url": "https://haes-hvac.fly.dev/vapi/server"
    }
  }
}
